\documentclass[../thesis.tex]{subfiles}

\begin{document}
  \chapter{Preliminaries}

  
  \todo{Move the following lemma to preliminaries.}
  \begin{lemma}
    The full embeddings are the right class of an orthogonal factorisation system on $\Cat$, where
    the left class are surjective-on-objects functors.
  \end{lemma}
  \begin{proof}
    Given any functor $F : A \to B$, let $A'$ denote the full subcategory of $B$ spanned by the
    objects in the image of $F$. Clearly $F$ then factors through $A'$ as
    \[\begin{codi}
      \obj {A & & B \\
            & A' & \\ };
      \mor A F:-> B;
      \mor[swap] A G:-> A' H:-> B;
    \end{codi}\]
    where $G$ is surjective on objects and $H$ is fully faithful and injective on objects.
  \end{proof}
  
  \section{Finite limit theories}

  \section{enriched categories}
  \label{sec:enriched}

  \subsection{Limits in enriched categories}
  \label{sec:enriched/limits}
  
  \section{2-categories}
  \label{sec:2-cats}

  \section{Fibrations}
  Originally introduced by Grothendieck in \cite{grothendieck1960} in the context of descent theory, fibrations
  have turned out to be an immensely useful tool in the categorical modelling of substitution in type theory.
  In essence, a fibration encodes the idea of a family of categories $(\cE_b)_{b \in \cB}$ indexed over a base
  category $\cB$, equipped with actions of morphisms $f^* : \cE_b \to \cE_{b'}$ for each morphism $f : b' \to
  b$. In essence, a fibration is a pseudofunctor $\cE_{(-)} : \cB \to \Cat$. However, rather than the complex
  algebraic structure that is a pseudofunctor, it turns out we can instead describe this structure by
  a \emph{functor} $p : \cE \to \cB$, where we call $\cE$ the total category of the fibration $p$, with
  the idea that we can define $\cE_{b}$ to be the fiber of $p$ over $b$: the objects $e$ are those of $\cE$
  which map to $b$, i.e.\ $p^{-1}(b) = \set{e \given p(e) = b}$, and morphisms $k : e \to e'$ are those of
  $\cE$ which lie over the identity, meaning that $p(k) = 1_b$.

  Since we will be working in general 2-categories, rather than only $\Cat$, we will define fibrations as
  certain 1-cells in a 2-category. 

  \begin{definition}[Cartesian morphism]
    Let $p : A \to B$ be a morphism of an 2-category $\cA$. A 2-cell $\phi : a_1 \to a_2 : X \to A$ is
    called \emph{$p$-cartesian} if for every $g : Y \loose X$, $a_0 : Y \loose A$, $\alpha : a_0 \to a_2g$,
    and $\beta : pa_0 \to pa_1g$ with $\beta \circ p\phi = p\alpha$, there exists a unique $\gamma : a_0 \to
    a_1g$ such that $\beta = p\gamma$ and $\alpha = \phi g \circ \gamma$. We will call the data $(g,a_0,
    \alpha,\beta)$ satisfying the equality $\beta \circ p\phi = p\alpha$ a cartesian cone.

    If $A^\to$ exists in $\bA$, we say that a 1-cell $f : X \to A^\to$ is cartesian when $\lambda f : \dom f
    \to \cod f$, the 2-cell induced by $f$, is cartesian.
  \end{definition}
  \begin{proposition}
    Let $p : A \to B$ be a tight morphism in an $\cF$-category $\bA$ with finite weighted limits and $\phi :
    a_1 \to a_2 : X \loose A$ a 2-cell. Consider the diagram $D : \bJ \to \cA$ (with $\bJ$ the obvious shape
    $\cF$-category) given by
    \[\begin{codi}
      \obj { X & A & B \\};
      \mor X ["a_1",name=x]:[->,bend left] A p:-> B;
      \mor X ["a_2",name=y,swap]:[->,bend right] A;
      \mor x \phi:-2> y;
    \end{codi}\]
    and weight $W : \bJ \to \bF$ generated by
    \[\begin{codi}
      \obj { |(X)| 1 & |(A)| H & |(B)| 3 \\};
      \mor X ["1",name=x]:[->,bend left] A c:-> B;
      \mor X ["2",name=y,swap]:[->,bend right] A;
      \mor x \phi:-2> y;
    \end{codi}\]
    where $H = \set{0 \to 2 \from 1}$ is the generic (tight) cospan, and $c : H \to 3$ maps the morphism $1 \to 2$ to
    the corresponding morphism in $3$ and $0 \to 2$ to the composite $0 \to 1 \to 2$ in $3$.

    A $W$-weighted cone over $D$ is exactly a cartesian cone over $\phi$.
  \end{proposition}

  \begin{proposition}\label{prop:cartesian by limit}
    Let $\bA$ be an $\cF$-category with finite weighted limits, $p : A \to B$ a 1-cell in $\bA$, and $\phi : a_1 \to
    a_2 : X \loose A$ a 2-cell in $\bA$. Then $\phi$ is cartesian if and only if $\ell = (\cod, \dom, \phi\cod \circ
    \lambda, p\lambda)$ is a universal cartesian cone with apex $A \comma a_1$.
  \end{proposition}
  \begin{proof}
    In the left-to-right direction, suppose $\phi$ is cartesian. We must show that for every object $Y$, the following
    hold:
    \begin{enumerate}[label=(\arabic*)]
      \item for every cartesian cone $(g,a,\alpha,\beta)$ with apex $Y$, there exists a unique morphism $h : Y \to A
        \comma a$ such that $g = \cod h$, $a = \dom h$, $\alpha = (\phi\cod \circ \lambda)h$ and $\beta = p\lambda h$.
      \item for every morphism of cones $m : (g,a,\alpha,\beta) \to (g',a',\alpha',\beta')$ there exists a unique
        morphism $h_m : h \to h'$ such that $m = h_m^* \ell$.
    \end{enumerate}
    For (1), note that since $(g,a,\alpha,\beta)$ is a cartesian cone and $\phi$ is cartesian, there exists a unique
    2-cell $\gamma : a \to a_1g$ such that $\alpha = \phi \circ \gamma$ and $\beta = p\gamma$. By the universal
    property of $A \comma a_1$, there then exists a unique morphism $\bar\gamma : Y \to A \comma a_1$ with $\lambda\bar
    \gamma = \gamma$. In particular, we have that $\cod\bar\gamma = g$, $\dom\bar\gamma = a$, $\alpha = \phi \circ
    \lambda\bar\gamma$, and $\beta = p\lambda\bar\gamma$, so taking $h = \bar\gamma$ we are done. Furthermore, $h =
    \bar\gamma$ is the unique such map by uniqueness of $\bar\gamma$ and $\gamma$.

    For (2), suppose we are given a modification $m : (g,a,\alpha,\beta) \to (g',a',\alpha',\beta')$. Concretely, $m$
    consists of two morphisms $m_1 : g \to g'$ and $m_2 : a \to a'$ such that the following squares commute:
    \[\begin{codi}[tetragonal=base 6em height 4.5em]
      \obj { a & a' & & pa & pa' \\ a_2g & a_2g' & & pa_1g & pa_1g' \\};
      \mor[swap] a \alpha:-> a_2g a_2m_1:-> a_2g';
      \mor a m_2:-> a' \alpha':-> a_2g';

      \mor pa pm_2:-> pa' \beta':-> pa_1g';
      \mor[swap] pa \beta:-> pa_1g pa_1m_1:-> pa_1g';
    \end{codi}\]
    We want to show that the square
    \[\begin{codi}[tetragonal=base 6em height 4.5em]
      \obj {a & a' \\ a_1g & a_1g' \\};
      \mor a m_2:-> a' \gamma':-> a_1g';
      \mor[swap] a \gamma:-> a_1g a_1m_1:-> a_1g';
    \end{codi}\]
    commutes as well, as that induces the desired unique morphism $\bar m : \bar \gamma \to \bar \gamma'$ with the
    desired properties. To that end, consider the cartesian cone over $Y$ given by $(g', a, \alpha'' = \alpha' \circ
    m_2, \beta'' = \beta'  \circ pm_2)$. To see that this is indeed a cone, we must show that $p\alpha'' = p\phi \circ
    \beta''$, but this follows from simple computation:
    \[p\alpha'' = p(\alpha' \circ m_2) = p\alpha' \circ pm_2 = p\phi \circ \beta' \circ pm_2 = p\phi \circ \beta''\]
    Since $(g',a,\alpha'',\beta'')$ is a cartesian cone and $r$ is cartesian, there exists a unique lift $\gamma''$
    with $p\gamma'' = \beta''$ and $\alpha'' = \phi g' \circ \gamma''$. But we have already that
    \[p(\gamma' \circ m_2) = p\gamma' \circ pm_2 = \beta' \circ pm_2 = \beta'' \text{\quad and \quad}
    \phi g' \circ \gamma' \circ m_2 = \alpha' \circ m_2 = \alpha'',\]
    and similarly
    \[p(a_1m_1 \circ \gamma) = pa_1m_1 \circ p\gamma = pa_1m_1 \circ \beta = \beta''\]
    and
    \[\phi g' \circ a_1m_1 \circ \gamma = a_2m_1 \circ \phi g \circ \gamma = a_2 m_1 \circ \alpha = \alpha'',\]
    where we use the interhcange law to commute $\phi$ and $m_1$.
    In particular, we see that both $\gamma' \circ m_2$ and $a_1m_1 \circ \gamma$ provide universal morphisms for
    the cartesian cone $(g',a,\alpha'', \beta'')$, from which we conclude that they must be identical by the uniqueness
    of such morphisms. Hence the diagram
    \[\begin{codi}[tetragonal=base 6em height 4.5em]
      \obj {a & a' \\ a_1g & a_1g' \\};
      \mor a m_2:-> a' \gamma':-> a_1g';
      \mor[swap] a \gamma:-> a_1g a_1m_1:-> a_1g';
    \end{codi}\]
    commutes.

    For the right-to-left direction, suppose that $(\cod,\dom,\phi\cod \circ \lambda, p\lambda)$ is a limiting cone
    with apex $A \comma a_1$, and let $(g,a,\alpha,\beta)$ be any cartesian cone with apex $Y$. By the universal
    property of limiting cones, there exists a unique morphism $\bar\gamma : Y \to A \comma a_1$ such that
    $\cod\bar\gamma = g$, $\dom\bar\gamma = a$, $(\phi\cod \circ \lambda)\bar\gamma = \alpha$, and
    $p\phi\bar\gamma = \beta$. In particular, taking $\gamma = \lambda\bar\gamma : a \to a_1g$, we have the
    desired morphism, and it is unique by the universal property of $A \comma a_1$.
  \end{proof}


  \begin{definition}[Fibration in an $\cF$-category]
    A \emph{fibration} in an $\cF$-category $\bA$ is a tight morphism $p : A \to B$ such that for every morphism $\phi :
    a_1 \to p a_2 : X \to B$ (with $a_1 : X \to B$ and $a_2 : X \to A$) there exists a $p$-cartesian morhism $\bar \phi :
    a_1' \to p a_2$ such that $\phi = p\bar\phi$.
  \end{definition}

  \begin{proposition}
    Let $p : A \to B$ be a tight morphism in an $\cF$-category $\bA$ with finite weighted limits. Then the
    following are equivalent:
    \begin{enumerate}[label=(\arabic*)]
      \item $p$ is a fibration.
      \item There exists a map $\ell : B \comma p \to A$ with $p\ell = \dom$ and $p$-cartesian 2-cell $\epsilon :
        \ell \to \cod$ with $p\epsilon = \lambda$, where $\lambda : \dom \to p\cod$ is the universal 2-cell for $B
        \comma p$.
      \item The map $t : A^\to \to B \comma p$ has a section $r : B \comma p \to A^\to$ which is $p$-cartesian.
      \item The canonical map $t : A^\to \to B \comma p$ has a right adjoint $r : B \comma p \to A^\to$
        with identity counit.
      \item The map $i : A \to B \comma p$ induced by the identity $1_p$ has a right adjoint $\ell : B \comma p
        \to A$ in the slice $\bA/B$ with invertible unit.
    \end{enumerate}
  \end{proposition}
  \begin{proof}
    We show that $(1) \iff (2) \implies (3) \implies (4) \implies (2)$ and $(2) \iff (5)$.

    For $(1) \implies (2)$, note that since $p$ is a fibration, there exists a $p$-cartesian lift $\epsilon : \ell
    \to \cod : B \comma p \to A$ for the 2-cell $\lambda : \dom \to p\cod : B \comma p \to B$, and this lift
    satisfies $p\epsilon = \lambda$. This is exactly the map we require.

    For $(2) \implies (1)$, note that since $\epsilon : \ell \to \cod$ is $p$-cartesian, so is $\epsilon x$ for
    all $f : X \loose B \comma p$. In particular, for any 2-cell $\phi : b \to pa$ with $b : X \to B$ and $a : X
    \to A$, we have an induced 1-cell $f : X \loose B \comma p$ with $\lambda f = \phi$. Then $\epsilon f$ is $p$-%
    cartesian, and by the properties of $\epsilon$, we have that $p\epsilon f = \lambda f = \phi$, so $\epsilon f$
    is a cartesian lift for $\phi$. Since $\phi$ was an arbitrary such 2-cell, we conclude that every such 2-cell
    has a caresian lift, which is exactly what it means for $p$ to be a fibration.


    For $(2) \implies (3)$, note that $\epsilon$ induces a map $r : B \comma p \to A^\to$ with $\lambda'r =
    \epsilon$, where $\lambda' : \dom' \to \cod' : A^\to \to A$ is the universal 2-cell associated with $A^\to$.
    This map then satisfies that $\lambda tr = p\lambda' r = p\epsilon = \lambda$, so that $tr = 1_{B \comma p}$,
    and $r$ is $p$-cartesian by definition.

    suppose that $p$ is a fibration. We require first of all a map $r : B \comma p \to
    A^\to$, which we then show is a $p$-cartesian section to $t : A^\to \to B \comma p$. Such a map $r$ is
    equivalently a 2-cell $\lambda r : \dom r \to \cod r : B \comma p \to A$. Since $p$ is a fibration, there
    exists a $p$-cartesian lift $\bar r : x \to \cod' : B \comma p \to A$ for the map $\lambda' : \dom' \to p
    \cod' : B \comma p \to B$, where $x : B \comma p \to A$ is such that $px = \dom'$. This map $\bar r$ induces
    a 1-cell $r : B \comma p \to A^\to$ with $\lambda \bar r = r$. In particular, we see that $\lambda' t r =
    p\lambda r = p\bar r = \lambda'$, so that $tr = 1_{B \comma p}$, as desired. Hence $r : B \comma p \to A^\to$
    is a $p$-cartesian section of $t$.

    For $(3) \implies (4)$, suppose $r$ is a $p$-cartesian 1-cell with $tr = 1_{B \comma p}$. We show that $r$
    is also a right-adjoint to $t$, for which we must find a unit $\eta : 1_{A^\to} \to rt$. By the universal
    property of $A^\to$, $\eta$ is equivalent to a commuting square
    \[\begin{codi}[tetragonal=base 6em height 4.5em]
      \obj {\dom' & \dom'rt \\ \cod' & \cod'rt \\};
      \mor       (dom ') \eta_1:-> (dom 'rt) \lambda'rt:-> (cod 'rt);
      \mor[swap] (dom ') \lambda':-> (cod ') \eta_2:-> (cod 'rt);
    \end{codi}\]
    Since $\cod'rt = \cod trt = \cod t = \cod'$, it would suffices to find a map $\eta_1$ such that
    $\lambda' = \lambda'rt \circ \eta_1$, since $\eta_2 = 1_{\cod'}$ then makes the above square commute. Since
    $r$ is a $p$-cartesian 1-cell, $\lambda'rt$ is a $p$-cartesian 2-cell, whereby there exists a unique universal
    map $\gamma : \dom' \to \dom'rt$ induced by the cone $(\cod', \dom', \lambda', 1_{p\dom'})$ with $p\gamma =
    1_{p\dom'}$ and $\lambda' = \lambda'rt \circ \gamma$, so we may take $\eta_1 = \gamma$, and then $\eta$ is
    the universal map induced by the square
    \[\begin{codi}[tetragonal=base 6em height 4.5em]
      \obj {\dom' & \dom'rt \\ \cod' & \cod'rt \\};
      \mor       (dom ') \gamma:-> (dom 'rt) \lambda'rt:-> (cod 'rt);
      \mor[swap] (dom ') \lambda':-> (cod ') 1_{\cod'}:-> (cod 'rt);
    \end{codi}\]
    To verify that $\eta : 1_{A^\to} \to rt$ is indeed the unit of an adjunction $t \dashv r$, we must verify that
    $t\eta = 1_t$ and $\eta r = 1_r$. For the former, it suffices to show that $\dom t\eta = 1_{\dom t}$ and
    $\cod t\eta = 1_{\cod t}$. But these hold since
    \[\dom t\eta = p\dom'\eta = p\gamma = 1_{p\dom'} = 1_{\dom t} \qquad\text{ and }\qquad
    \cod t\eta = \cod'\eta = 1_{\cod'} = 1_{\cod t}.\]
    Hence $t\eta = 1_t$. For the latter equation $\eta r = 1_r$, we must show that $\gamma r = 1_{\dom' r}$,
    for which it suffices to see that $1_{\dom' r}$ and $\gamma r$ both are universal morphisms for the same
    $p$-cartesian cone over $\lambda'r : \dom' r \to \cod' r : B\comma p \to A$. The cone we consider is
    specifically $(1_{B \comma p}, \dom'r, \lambda'r, 1_{p\dom'r})$ with apex $B \comma p$, which clearly
    satisfies $p\lambda'r = p\lambda'r \circ 1_{p\dom'}$. Furthermore, we clearly see that $1_{\dom' r}$ is
    a universal map over the cone, and that $p\gamma r = 1_{p\dom' r}$ and $\lambda'r \circ \gamma r =
    \lambda'rtr \circ \gamma r = (\lambda'rt \circ \gamma)r = \lambda'r$, so $\gamma r$ is another such
    universal map. Hence $\gamma r = 1_{\dom' r}$, from which we conclude that $\eta r = 1_r$. Hence
    $\eta$ is the unit of an adjunction $t \dashv r$ with identity counit.

    For $(4) \implies (2)$, we must show that the right adjoint $r : B \comma p \to A^\to$ is $p$-cartesian, so let
    $(g,a,\alpha,\beta)$ be a $p$-cartesian cone over $\lambda' r : \dom' r \to \cod' r$ with apex $Y$. Thus
    $g : Y \to B \comma p$, $a : Y \to A$, $\alpha : a \to \cod'r g$, and $\beta : pa \to p\dom'rg = \dom trg
    = \dom g$.
  \end{proof}

  \begin{notation}
    For any fibration $p : A \to B$ with a chosen lifting $\epsilon : \ell \to \cod$ with $\ell : B \comma p \to A$
    as in (2), and any object $X$ and morphisms $a : X \to A$, $b : X \to B$, and $\sigma : b \to pa$, we write
    $A[\sigma] \coloneq \ell\bar\sigma$, where $\bar \sigma : X \to B \comma p$ is the map induced by $\sigma$.
  \end{notation}
  \end{document}
